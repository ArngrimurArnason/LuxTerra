{% extends 'Home/base.html' %}
{% load static %}
{% load humanize %}
{% block content %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/properties.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>
{% endblock %}

    <h2 id="h2">Find a place where dreams come home<br>-LuxTerra</h2>
    <form method="get" action="{% url 'properties' %}">
    <div class="filter-container">
        <div class="filters">
            <label>
                Postal code
                <select name="postal_code" class="custom-select">
                    <option value="">Any</option>
                    <option value="102" {% if request.GET.postal_code == "102" %}selected{% endif %}>102</option>

                </select>
            </label>

            <label>
              Price range (kr)
              <div style="display: flex; gap: 10px; align-items: center;">
                <select name="min_price" class="custom-select">
                  <option value="">Min</option>
                  {% for price in prices %}
                    <option value="{{ price }}" {% if request.GET.min_price == price|stringformat:"s" %}selected{% endif %}>
                      {{ price|intcomma }} kr
                    </option>
                  {% endfor %}
                </select>
                <span>‚Äì</span>
                <select name="max_price" class="custom-select">
                  <option value="">Max</option>
                  {% for price in prices %}
                    <option value="{{ price }}" {% if request.GET.max_price == price|stringformat:"s" %}selected{% endif %}>
                      {{ price|intcomma }} kr
                    </option>
                  {% endfor %}
                </select>
              </div>
            </label>

            <label>
                Property type
                <select name="property_type" class="custom-select">
                    <option value="">Any</option>
                    <option value="apartment">Apartment</option>
                    <option value="house">House</option>
                    <option value="bungalow">Bungalow</option>
                    <option value="villa">Villa</option>
                    <option value="penthouse">Penthouse</option>
                </select>
            </label>

            <label>
                Street name
                <input type="text" name="street_name" class="custom-input" placeholder="">
            </label>

            <label>
                &nbsp;
                <button class="search-button">üîç</button>
            </label>

        </div>

    </div>
    <div class="sort-container-wrapper">
        <div class="sort-container">
            <label for="order_by">Order by</label>
            <select name="order_by" id="order_by" class="custom-select">
                <option value="">Default</option>
                <option value="price_asc">Price: Low to High</option>
                <option value="price_desc">Price: High to Low</option>
                <option value="size_asc">Size: Small to Large</option>
                <option value="size_desc">Size: Large to Small</option>
                <option value="date_desc">Newest First</option>
                <option value="date_asc">Oldest First</option>
            </select>
        </div>
    </div>
    </form>
   <div class="property-container">
    {% for p in properties %}
    <div class="card prop">
        <a href="{% url 'property_details' p.property_id %}" class="card-link">
            <div class="property-image" style="background-image: url('{{ p.thumbnail.url }}');">
                <div class="property-address">
                    √çb√∫√∞areign: {{ p.post_code }} {{ p.city }}
                </div>
            </div>
            <div class="card-body">
                <!-- Street + Location in same row -->
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="property-street mb-0">{{ p.street }} {{ p.house_number }}</h3>
                    <p class="text-muted mb-0">{{ p.location }}</p>
                </div>

                <!-- One divider above icons -->
                <hr class="my-2">

                <div class="property-details">
                    <div class="size-detail">{{ p.size }} m¬≤</div>
                    <div class="room-detail">{{ p.bedrooms }}</div>
                    <div class="bathroom-detail">{{ p.bathroom }}</div>
                </div>

                <!-- No extra <hr> here -->
                <div class="property-price">{{ p.price }} kr</div>
            </div>
        </a>
    </div>
{% endfor %}
</div>

{% endblock %}
